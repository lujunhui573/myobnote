---
share: "true"
---


### 导入数据
将表3、表6的数据导入PQ
![导入.gif](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E5%AF%BC%E5%85%A5.gif)

### 以单据号为依据，对数量进行分组求和
如果单据号是存在重复的，两份数据合并时就无法做到完全一对一匹配。所以要以单据号为依据，对数量进行分组求和,使得每个单据号都成为唯一的，再进行匹配。
这个操作的作用与工作表界面的透视表操作是类似的。但在这里操作更方便，且不留下中间痕迹。如果原始数据有变动，也能相应变动。
![按单据号分组.mp4_20230325_102846.gif](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E6%8C%89%E5%8D%95%E6%8D%AE%E5%8F%B7%E5%88%86%E7%BB%84.mp4_20230325_102846.gif)

### 以单据号为依据，将两份数据合并
这一步相当于在工作表中使用vlookup进行匹配，但更方便。遇到两边单据号存在不同项时，也不需要在左边表里匹配右边，再到右边表里匹配左边这么麻烦。
1. 合并时选择完全外部合并，使得只存在于表3、表6的一个表中的单据号也得到保留（在这个案例中，并没有这种情况，但这样做是保险的）。
2. 将合并的表展开。
![合并两份表格.mp4_20230325_103247.gif](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%BB%BD%E8%A1%A8%E6%A0%BC.mp4_20230325_103247.gif)

### 两列数量相减计算差异
1. 将空白（null）替换为0，然后相减得到差异；或者使用`List.Sum({[数量],-[表3.数量]})`直接求差异。不能直接相减是因为在减法运算中，只要一个数值为空白（null）,则结果为空白（null）。
   - 填充0再相减
     ![](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E5%A1%AB%E5%85%850%E5%B9%B6%E7%9B%B8%E5%87%8F.mp4_20230325_103400.gif)
   - 或者，不填充，直接使用`List.Sum()`
     ![](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E7%94%A8ListSum%E7%9B%B4%E6%8E%A5%E7%9B%B8%E5%87%8F.mp4_20230325_103500.gif)

2. 对差异列进行筛选，选出不为0的行。
![](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E7%AD%9B%E9%80%89%E9%9D%9E0%E9%A1%B9.mp4_20230325_103620.gif)

### 发现不对，再回头做下修改
检查数据，发现明显不对，不会有这么大的差异。原因是因为忘了对表3进行筛选，仅保留水泥块相关的部分。回头再作下修改。
它的所有步骤都是有记录的。哪里不对，改哪里就可以了，其它对的部分都是不用动的。这是使用PQ相较于直接操作工作表的巨大优势。
![回头修改错误.mp4_20230325_103711.gif](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E5%9B%9E%E5%A4%B4%E4%BF%AE%E6%94%B9%E9%94%99%E8%AF%AF.mp4_20230325_103711.gif)

### 将结果加载到表格
1. 建议先加载为“仅链接”，这样不会导致不想要的表格也被加载到工作表。
2. 选择想要的那个查询“合并”，右击，加载到工作表。选择新工作表。
![](https://ljh573.oss-cn-shanghai.aliyuncs.com/pic/%E5%8A%A0%E8%BD%BD%E5%88%B0%E8%A1%A8%E6%A0%BC.mp4_20230325_103904.gif)
